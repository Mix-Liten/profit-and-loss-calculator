<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Profit and Loss Calculator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
</head>
<body>
    <h3 class="text-center my-3">損益計算器</h3>
    
    <hr>

    <div class="container">
        <form>
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="a">成本價</label>
                        <input type="number" class="form-control" autocomplete="off" step="0.1" id="a">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="b">目標價</label>
                        <input type="number" class="form-control" autocomplete="off" step="0.1" id="b">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="n">交易股數</label>
                        <input type="number" class="form-control" autocomplete="off" value="1000" step="1000" id="n">
                    </div>
                </div>
            </div>
        </form>

        <table class="table table-sm table-bordered table-hover" id="table"></table>
    </div>
    <script>
        handleInput = () => {
            const a = Number(document.getElementById('a').value);
            const b = Number(document.getElementById('b').value);
            const n = Number(document.getElementById('n').value);

            if (!a || !b || !n) {
                return;
            }

            const x = 0.1425 * 0.01;
            const y = 0.3 * 0.01;
            const z = 10;

            const content = Array(z + 1)
                .fill('')
                .map((v, i) => {
                    return i - z / 2;
                })
                .map((r, i) => {
                    const c = (b + r) * n * (1 - x - y) - (a * n * (1 + x));
                    const d = c / (a * n) * 100;
                    const e = r === 0 ? 'gold' : r === a - b ? 'paleturquoise' : '';

                    return `
                        <tr class="text-center" style="background: ${e};">
                            <td>
                                ${(b + r).toFixed(2)}
                            </td>
                            <td style="color: ${c > 0 ? 'red' : 'green'};">
                                ${Number(c.toFixed(2)).toLocaleString()}
                            </td>
                            <td style="color: ${c > 0 ? 'red' : 'green'};">
                                ${Number(d.toFixed(2)).toLocaleString()}%
                            </td>
                        </tr>
                    `;
                })
                .join('');

            const table = `
                <thead>
                    <tr class="text-center">
                        <th>
                            成交價
                        </th>
                        <th>
                            損益金額
                        </th>
                        <th>
                            報酬率
                        </th>
                    </tr>
                </thead>
                <tbody id="content">
                    ${content}
                </tbody>
            `;

            document.getElementById('table').innerHTML = table;
        };

        document.addEventListener('input', handleInput);
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117292723-8"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-117292723-8');
    </script>
</body>
</html>
